<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìù Hello Kitty Tasks üéÄ</title>
    <link rel="stylesheet" href="/static/css/kitty-theme.css">
    <style>
        body.kitty-body {
            padding: 20px;
            min-height: 100vh;
            background: linear-gradient(135deg, #FFB6C1, #FF69B4) !important;
        }

        .tasks-page-container {
            max-width: 900px;
            margin: 40px auto;
            padding: 30px;
            background: white;
            border-radius: 35px;
            border: 6px solid #FF1493;
            box-shadow: 0 20px 50px rgba(255, 20, 147, 0.25);
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .kitty-title {
            color: #FF1493 !important;
            text-shadow: 3px 3px 0 #FFB6C1;
            font-size: 48px;
            margin: 20px 0;
        }

        .kitty-subtitle {
            color: #FF69B4;
            font-size: 28px;
            margin: 15px 0;
        }

        .task-form-section {
            background: linear-gradient(135deg, #FFF5F7, #FFE6EB);
            border-radius: 25px;
            padding: 35px;
            margin-bottom: 40px;
            border: 4px solid #FFB6C1;
            box-shadow: 0 10px 30px rgba(255, 182, 193, 0.2);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 12px;
            color: #FF1493;
            font-weight: bold;
            font-size: 18px;
            font-family: 'Comic Sans MS', cursive;
        }

        .kitty-input, .kitty-select {
            width: 100%;
            padding: 16px;
            font-size: 16px;
            border: 3px solid #FFB6C1;
            border-radius: 18px;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', cursive;
        }

        .kitty-input:focus, .kitty-select:focus {
            border-color: #FF69B4;
            outline: none;
            box-shadow: 0 0 15px rgba(255, 105, 180, 0.3);
        }

        textarea.kitty-input {
            min-height: 120px;
            resize: vertical;
        }

        .priority-control {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 20px;
            border: 3px solid #FFB6C1;
            margin: 20px 0;
        }

        .priority-slider {
            width: 100%;
            height: 12px;
            -webkit-appearance: none;
            background: #FFB6C1;
            border-radius: 10px;
            margin: 20px 0;
        }

        .priority-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 30px;
            height: 30px;
            background: #FF1493;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 0 10px rgba(255, 20, 147, 0.5);
        }

        .stars-display {
            font-size: 28px;
            margin: 15px 0;
            min-height: 35px;
            letter-spacing: 5px;
        }

        .create-task-btn {
            display: block;
            width: 100%;
            padding: 20px;
            font-size: 22px;
            background: linear-gradient(135deg, #FF69B4, #FF1493);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Comic Sans MS', cursive;
            margin-top: 20px;
            border: 4px solid white;
            box-shadow: 0 10px 25px rgba(255, 20, 147, 0.3);
            transition: all 0.3s;
        }

        .create-task-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(255, 20, 147, 0.4);
        }

        .tasks-list-section {
            margin-top: 40px;
        }

        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px;
            margin: 20px 0;
            background: white;
            border-radius: 25px;
            border: 4px solid #FFB6C1;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(255, 182, 193, 0.15);
        }

        .task-item:hover {
            border-color: #FF69B4;
            transform: translateX(10px);
            box-shadow: 0 15px 35px rgba(255, 105, 180, 0.25);
        }

        .task-info {
            flex: 1;
            padding-right: 25px;
        }

        .task-title {
            margin: 0 0 12px 0;
            color: #FF1493;
            font-size: 24px;
            font-weight: bold;
        }

        .task-description {
            margin: 0 0 20px 0;
            color: #666;
            line-height: 1.6;
            font-size: 16px;
        }

        .task-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .task-status {
            display: inline-block;
            padding: 10px 22px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            margin-right: 10px;
            font-family: 'Comic Sans MS', cursive;
        }

        .status-todo {
            background: linear-gradient(135deg, #FFE6EB, #FFD1DC);
            color: #FF6B6B;
            border: 2px solid #FF6B6B;
        }

        .status-in-progress {
            background: linear-gradient(135deg, #E6F7F6, #D1F0E6);
            color: #4ECDC4;
            border: 2px solid #4ECDC4;
        }

        .status-done {
            background: linear-gradient(135deg, #E6F7EF, #D1F0E6);
            color: #1DD1A1;
            border: 2px solid #1DD1A1;
        }

        .priority-stars {
            font-size: 24px;
            letter-spacing: 3px;
            color: #FFD700;
        }

        .task-category {
            display: inline-block;
            background: linear-gradient(135deg, #FFF5F7, #FFE6EB);
            color: #FF1493;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            border: 2px solid #FFB6C1;
            font-family: 'Comic Sans MS', cursive;
        }

        .task-actions {
            display: flex;
            gap: 15px;
            flex-shrink: 0;
        }

        .action-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 20px;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 60px;
            text-align: center;
            font-family: 'Comic Sans MS', cursive;
        }

        .btn-progress {
            background: linear-gradient(135deg, #4ECDC4, #1DD1A1);
            color: white;
            border: 3px solid white;
        }

        .btn-done {
            background: linear-gradient(135deg, #1DD1A1, #4ECDC4);
            color: white;
            border: 3px solid white;
        }

        .btn-delete {
            background: linear-gradient(135deg, #FF6B6B, #FF4F4F);
            color: white;
            border: 3px solid white;
        }

        .action-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .empty-state {
            text-align: center;
            padding: 60px 40px;
            background: linear-gradient(135deg, #FFF5F7, #FFE6EB);
            border-radius: 30px;
            border: 4px dashed #FFB6C1;
            margin: 40px 0;
        }

        .empty-state h3 {
            color: #FF1493;
            font-size: 28px;
            margin-bottom: 20px;
        }

        .empty-state p {
            color: #FF69B4;
            font-size: 18px;
            margin-bottom: 30px;
        }

        .error-state {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #FFD1DC, #FFB6C1);
            border-radius: 25px;
            border: 4px solid #FF6B6B;
            margin: 30px 0;
        }

        .loading-state {
            text-align: center;
            padding: 60px;
            color: #FF69B4;
            font-size: 22px;
        }

        .page-navigation {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .nav-link {
            display: inline-block;
            padding: 15px 35px;
            background: linear-gradient(135deg, #FFF5F7, #FFE6EB);
            color: #FF1493;
            text-decoration: none;
            font-weight: bold;
            border-radius: 25px;
            border: 3px solid #FFB6C1;
            font-family: 'Comic Sans MS', cursive;
            font-size: 18px;
            transition: all 0.3s;
        }

        .nav-link:hover {
            background: linear-gradient(135deg, #FF69B4, #FF1493);
            color: white;
            border-color: #FF1493;
            transform: translateY(-3px);
            text-decoration: none;
        }

        .kitty-emoji {
            font-size: 40px;
            text-align: center;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .tasks-page-container {
                padding: 20px;
                margin: 20px auto;
                border-radius: 25px;
            }

            .kitty-title {
                font-size: 36px;
            }

            .kitty-subtitle {
                font-size: 24px;
            }

            .task-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }

            .task-actions {
                width: 100%;
                justify-content: center;
            }

            .task-info {
                padding-right: 0;
            }

            .task-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .page-navigation {
                flex-direction: column;
                align-items: center;
            }

            .nav-link {
                width: 100%;
                text-align: center;
                max-width: 300px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="kitty-body">
    <div class="tasks-page-container">
        <div class="page-header">
            <h1 class="kitty-title">üìù –ú–æ–∏ –∑–∞–¥–∞—á–∏ üéÄ</h1>
            <div class="kitty-emoji">üê±üìùüå∏‚ú®</div>
        </div>

        <div class="page-navigation">
            <a href="/" class="nav-link">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
            <a href="/docs" class="nav-link">üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</a>
            <a href="/health" class="nav-link">‚ù§Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</a>
        </div>

        <div class="task-form-section">
            <h2 class="kitty-subtitle" style="text-align: center; margin-bottom: 30px;">‚ú® –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É</h2>

            <div class="form-group">
                <label for="taskTitle"><i class="fas fa-pencil-alt"></i> –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏:</label>
                <input type="text" id="taskTitle" class="kitty-input" placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å? üéÄ">
            </div>

            <div class="form-group">
                <label for="taskDescription"><i class="fas fa-align-left"></i> –û–ø–∏—Å–∞–Ω–∏–µ:</label>
                <textarea id="taskDescription" class="kitty-input" rows="4" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏... üå∏"></textarea>
            </div>

            <div class="form-group">
                <label for="taskStatus"><i class="fas fa-flag"></i> –°—Ç–∞—Ç—É—Å:</label>
                <select id="taskStatus" class="kitty-select">
                    <option value="todo">üìù –°–¥–µ–ª–∞—Ç—å</option>
                    <option value="in_progress">üèÉ‚Äç‚ôÄÔ∏è –í –ø—Ä–æ—Ü–µ—Å—Å–µ</option>
                    <option value="done">‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ</option>
                </select>
            </div>

            <div class="form-group">
                <label for="taskCategory"><i class="fas fa-folder"></i> –ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                <select id="taskCategory" class="kitty-select">
                    <option value="school">üìö –£—á–µ–±–∞</option>
                    <option value="home">üè† –î–æ–º</option>
                    <option value="work">üíº –†–∞–±–æ—Ç–∞</option>
                    <option value="fun" selected>üéÆ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</option>
                    <option value="shopping">üõçÔ∏è –ü–æ–∫—É–ø–∫–∏</option>
                </select>
            </div>

            <div class="priority-control">
                <label style="display: block; margin-bottom: 15px; color: #FF1493; font-size: 20px;">
                    <i class="fas fa-star"></i> –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
                </label>
                <input type="range" id="taskPriority" min="1" max="5" value="3" class="priority-slider">
                <div id="priorityStars" class="stars-display">‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ</div>
            </div>

            <button onclick="createTask()" class="create-task-btn">
                üéÄ –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É ‚ú®
            </button>
        </div>

        <div class="tasks-list-section">
            <h2 class="kitty-subtitle" style="text-align: center; margin-bottom: 30px;">üå∏ –ú–æ–∏ –∑–∞–¥–∞—á–∏</h2>
            <div id="taskList">
                <div class="loading-state">
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á... üê±</p>
                    <div style="font-size: 40px; margin-top: 20px;">‚è≥</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const categoryEmojis = {
            'school': 'üìö',
            'home': 'üè†',
            'work': 'üíº',
            'fun': 'üéÆ',
            'shopping': 'üõçÔ∏è'
        };

        const categoryNames = {
            'school': '–£—á–µ–±–∞',
            'home': '–î–æ–º',
            'work': '–†–∞–±–æ—Ç–∞',
            'fun': '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è',
            'shopping': '–ü–æ–∫—É–ø–∫–∏'
        };

        function renderStars(priority) {
            priority = Math.min(5, Math.max(1, parseInt(priority) || 3));
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= priority) {
                    stars += '‚≠ê';
                } else {
                    stars += '‚òÜ';
                }
            }
            return stars;
        }

        document.getElementById('taskPriority').addEventListener('input', function() {
            const value = parseInt(this.value);
            document.getElementById('priorityStars').textContent = renderStars(value);
        });

        document.addEventListener('DOMContentLoaded', function() {
            const prioritySlider = document.getElementById('taskPriority');
            const priorityStars = document.getElementById('priorityStars');
            priorityStars.textContent = renderStars(prioritySlider.value);
            loadTasks();
        });

        async function loadTasks() {
            try {
                const response = await fetch('/tasks');
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');

                const data = await response.json();
                const taskList = document.getElementById('taskList');

                if (!data.tasks || data.tasks.length === 0) {
                    taskList.innerHTML = `
                        <div class="empty-state">
                            <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–¥–∞—á! üéÄ</h3>
                            <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É –≤—ã—à–µ! ‚ú®</p>
                            <div style="font-size: 60px; margin: 30px 0;">üê±üå∏</div>
                        </div>
                    `;
                    return;
                }

                taskList.innerHTML = '';

                data.tasks.forEach(task => {
                    const taskItem = document.createElement('div');
                    taskItem.className = 'task-item';

                    const statusClass = {
                        'todo': 'status-todo',
                        'in_progress': 'status-in-progress',
                        'done': 'status-done'
                    }[task.status] || 'status-todo';

                    const statusText = {
                        'todo': 'üìù –°–¥–µ–ª–∞—Ç—å',
                        'in_progress': 'üèÉ‚Äç‚ôÄÔ∏è –í –ø—Ä–æ—Ü–µ—Å—Å–µ',
                        'done': '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ'
                    }[task.status] || 'üìù –°–¥–µ–ª–∞—Ç—å';

                    const starsHTML = renderStars(task.priority || 3);
                    const categoryEmoji = categoryEmojis[task.category] || 'üê±';
                    const categoryName = categoryNames[task.category] || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';

                    taskItem.innerHTML = `
                        <div class="task-info">
                            <h3 class="task-title">${task.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h3>
                            <p class="task-description">${task.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                            <div class="task-meta">
                                <span class="task-status ${statusClass}">${statusText}</span>
                                <span class="priority-stars">${starsHTML}</span>
                                <span class="task-category">${categoryEmoji} ${categoryName}</span>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button onclick="updateTask(${task.id}, 'in_progress')" class="action-btn btn-progress" title="–í –ø—Ä–æ—Ü–µ—Å—Å–µ">
                                üèÉ‚Äç‚ôÄÔ∏è
                            </button>
                            <button onclick="updateTask(${task.id}, 'done')" class="action-btn btn-done" title="–í—ã–ø–æ–ª–Ω–µ–Ω–æ">
                                ‚úÖ
                            </button>
                            <button onclick="deleteTask(${task.id})" class="action-btn btn-delete" title="–£–¥–∞–ª–∏—Ç—å">
                                üóëÔ∏è
                            </button>
                        </div>
                    `;

                    taskList.appendChild(taskItem);
                });

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á:', error);
                document.getElementById('taskList').innerHTML = `
                    <div class="error-state">
                        <h3 style="color: #FF6B6B; margin-bottom: 20px;">üòø –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–¥–∞—á–∏</h3>
                        <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É</p>
                        <button onclick="loadTasks()" class="create-task-btn" style="margin-top: 20px; max-width: 200px;">
                            –ü–æ–≤—Ç–æ—Ä–∏—Ç—å
                        </button>
                    </div>
                `;
            }
        }

        async function createTask() {
            const title = document.getElementById('taskTitle').value.trim();
            const description = document.getElementById('taskDescription').value.trim();
            const status = document.getElementById('taskStatus').value;
            const category = document.getElementById('taskCategory').value;
            const priority = parseInt(document.getElementById('taskPriority').value);

            if (!title) {
                alert('üéÄ –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏!');
                return;
            }

            try {
                const response = await fetch('/tasks', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: title,
                        description: description,
                        status: status,
                        category: category,
                        priority: priority
                    })
                });

                if (response.ok) {
                    document.getElementById('taskTitle').value = '';
                    document.getElementById('taskDescription').value = '';
                    document.getElementById('taskPriority').value = 3;
                    document.getElementById('priorityStars').textContent = renderStars(3);

                    alert('‚ú® –ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞!');
                    loadTasks();
                } else {
                    const error = await response.json();
                    alert('üòø –û—à–∏–±–∫–∞: ' + (error.detail || '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É'));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('üíî –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É');
            }
        }

        async function updateTask(taskId, newStatus) {
            try {
                const response = await fetch(`/tasks/${taskId}`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status: newStatus })
                });

                if (response.ok) {
                    alert('‚úÖ –ó–∞–¥–∞—á–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
                    loadTasks();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('üòø –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É');
            }
        }

        async function deleteTask(taskId) {
            if (!confirm('üéÄ –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?')) return;

            try {
                const response = await fetch(`/tasks/${taskId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('üóëÔ∏è –ó–∞–¥–∞—á–∞ —É–¥–∞–ª–µ–Ω–∞!');
                    loadTasks();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('üòø –ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É');
            }
        }

        setInterval(loadTasks, 30000);
    </script>
</body>
</html>